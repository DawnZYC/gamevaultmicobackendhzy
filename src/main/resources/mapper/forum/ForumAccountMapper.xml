<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sg.nusiss.gamevaultbackend.mapper.forum.ForumAccountMapper">

    <!-- 结果映射 -->
    <resultMap id="AccountResultMap" type="ForumAccount">
        <id property="accountId" column="account_id"/>
        <result property="username" column="username"/>
        <result property="password" column="password"/>
        <result property="userId" column="user_id"/>
        <result property="createdDate" column="created_date"/>
    </resultMap>

    <!-- 根据用户名查找账户 -->
    <select id="findByUsername" resultMap="AccountResultMap">
        SELECT account_id, username, password, user_id, created_date
        FROM accounts
        WHERE username = #{username}
    </select>

    <!-- 插入新账户 -->
    <insert id="insert" parameterType="ForumAccount"
            useGeneratedKeys="true" keyProperty="accountId">
        INSERT INTO accounts (username, password, user_id, created_date)
        VALUES (#{username}, #{password}, #{userId}, #{createdDate})
    </insert>

    <!-- 检查用户名是否存在 -->
    <select id="existsByUsername" resultType="boolean">
        SELECT EXISTS(
            SELECT 1 FROM accounts WHERE username = #{username}
        )
    </select>

    <!-- 根据账户ID查找 -->
    <select id="findById" resultMap="AccountResultMap">
        SELECT account_id, username, password, user_id, created_date
        FROM accounts
        WHERE account_id = #{accountId}
    </select>

    <!-- 根据用户ID查找账户 -->
    <select id="findByUserId" resultMap="AccountResultMap">
        SELECT account_id, username, password, user_id, created_date
        FROM accounts
        WHERE user_id = #{userId}
    </select>

</mapper>